# .github/settings.yml
# Bulletproof protection for "main" and "master" with auto-merge enabled

repository:
  # name: your-repo-name

rulesets:
  - name: "Protect default branches"
    target: branch
    enforcement: active

    conditions:
      ref_name:
        include:
          - "refs/heads/main"
          - "refs/heads/master"
        exclude: []

    rules:
      # ❌ Block non-fast-forward (no force pushes)
      - type: non_fast_forward

      # ❌ Block all direct updates—PR merge only
      - type: update
        parameters:
          allowed_actions: []          # no direct pushes
          allow_deletions: false       # cannot delete main/master
          block_creations: true        # cannot recreate main/master

      # ✔ PRs required but **zero approvals needed**
      - type: pull_request
        parameters:
          required_approvals: 0
          require_code_owner_review: false
          block_force_pushes: true
          block_creations: true
          block_deletions: true
          require_last_push_approval: false

      # ✔ Strict required checks for both branches
      - type: required_status_checks
        parameters:
          strict_required_status_checks_policy: true
          required_status_checks:
            - context: "CI / test"
            - context: "PRE-COMMIT / pre-commit"
            - context: "DEPTRY / deptry"
            - context: "MARIMO / test-notebooks"

    # ❌ No bypass, not even admins or GitHub Actions
    bypass_actors: []
